# TemplateService Documentation

## –û–±–∑–æ—Ä

`TemplateService` - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏ –ø–æ—Å—Ç–æ–≤ –≤ Telegram –±–æ—Ç–µ. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É–¥–∞–ª—è—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏** - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –Ω—É–∂–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
- **–≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤

### –¢–∏–ø—ã —à–∞–±–ª–æ–Ω–æ–≤
- **–¢–µ–∫—Å—Ç–æ–≤—ã–µ** - –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–° –º–µ–¥–∏–∞** - —à–∞–±–ª–æ–Ω—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
- **–° –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏** - —à–∞–±–ª–æ–Ω—ã —Å –∑–∞–º–µ–Ω—è–µ–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** - —à–∞–±–ª–æ–Ω—ã, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Ç–µ–º–∞–º

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
TemplateService
‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ create_template()
‚îÇ   ‚îú‚îÄ‚îÄ update_template()
‚îÇ   ‚îú‚îÄ‚îÄ delete_template()
‚îÇ   ‚îî‚îÄ‚îÄ duplicate_template()
‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ get_template_by_id()
‚îÇ   ‚îú‚îÄ‚îÄ get_template_by_name()
‚îÇ   ‚îú‚îÄ‚îÄ get_user_templates()
‚îÇ   ‚îî‚îÄ‚îÄ get_templates_count()
‚îú‚îÄ‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ create_post_from_template()
‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ search_templates()
‚îÇ   ‚îî‚îÄ‚îÄ get_recommended_templates()
‚îú‚îÄ‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ get_template_categories()
‚îÇ   ‚îî‚îÄ‚îÄ get_template_statistics()
‚îî‚îÄ‚îÄ –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç
    ‚îú‚îÄ‚îÄ export_template()
    ‚îî‚îÄ‚îÄ import_template()
```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **AdminPostService** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
- **Repository** - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **NotificationService** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.8+
- SQLAlchemy 2.0+
- asyncpg
- loguru

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

1. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è —à–∞–±–ª–æ–Ω–∞ –≤ –º–æ–¥–µ–ª—å `AdminPost`:
```python
is_template = Column(Boolean, default=False, nullable=False)
template_name = Column(String(255), nullable=True)
template_description = Column(Text, nullable=True)
```

2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å:
```python
from database.services.template_service import TemplateService
```

3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤ `UnitOfWork`:
```python
self.template_service = TemplateService(session, self.repository)
```

## API Reference

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏

#### `create_template()`
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –ø–æ—Å—Ç–∞.

```python
async def create_template(
    title: str,
    content: str,
    template_name: str,
    created_by: int,
    template_description: Optional[str] = None,
    media_type: Optional[MediaType] = None,
    media_file_id: Optional[str] = None,
    media_caption: Optional[str] = None,
    hashtags: Optional[List[str]] = None,
    links: Optional[List[Dict[str, str]]] = None,
    categories: Optional[List[str]] = None,
) -> AdminPost
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `title` - –∑–∞–≥–æ–ª–æ–≤–æ–∫ —à–∞–±–ª–æ–Ω–∞
- `content` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞
- `template_name` - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —à–∞–±–ª–æ–Ω–∞
- `created_by` - ID —Å–æ–∑–¥–∞—Ç–µ–ª—è
- `template_description` - –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
- `media_type` - —Ç–∏–ø –º–µ–¥–∏–∞ (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç)
- `media_file_id` - ID –º–µ–¥–∏–∞ —Ñ–∞–π–ª–∞ –≤ Telegram
- `media_caption` - –ø–æ–¥–ø–∏—Å—å –∫ –º–µ–¥–∏–∞
- `hashtags` - —Å–ø–∏—Å–æ–∫ —Ö–µ—à—Ç–µ–≥–æ–≤
- `links` - —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫
- `categories` - —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±—ä–µ–∫—Ç `AdminPost` —Å `is_template=True`

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `ValueError` - –µ—Å–ª–∏ —à–∞–±–ª–æ–Ω —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

#### `update_template()`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —à–∞–±–ª–æ–Ω–∞.

```python
async def update_template(
    template_id: int,
    user_id: int,
    **kwargs
) -> AdminPost
```

#### `delete_template()`
–£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞.

```python
async def delete_template(
    template_id: int,
    user_id: int
) -> bool
```

#### `duplicate_template()`
–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º.

```python
async def duplicate_template(
    template_id: int,
    user_id: int,
    new_template_name: str
) -> AdminPost
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

#### `get_user_templates()`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π.

```python
async def get_user_templates(
    user_id: int,
    limit: int = 50,
    offset: int = 0,
    search: Optional[str] = None,
    category: Optional[str] = None,
    sort_by: str = "created_at",
    sort_order: str = "desc",
) -> List[AdminPost]
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `limit` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- `search` - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `category` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `sort_by` - –ø–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `sort_order` - –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (asc/desc)

#### `get_template_by_name()`
–ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø–æ –∏–º–µ–Ω–∏.

```python
async def get_template_by_name(
    template_name: str,
    user_id: int
) -> Optional[AdminPost]
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

#### `create_post_from_template()`
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞.

```python
async def create_post_from_template(
    template_id: int,
    user_id: int,
    title: Optional[str] = None,
    content: Optional[str] = None,
    target_groups: Optional[List[int]] = None,
    scheduled_at: Optional[datetime] = None,
    expires_at: Optional[datetime] = None,
    priority: int = 0,
    override_media: bool = False,
    new_media_type: Optional[MediaType] = None,
    new_media_file_id: Optional[str] = None,
    new_media_caption: Optional[str] = None,
    additional_hashtags: Optional[List[str]] = None,
    additional_links: Optional[List[Dict[str, str]]] = None,
    additional_categories: Optional[List[str]] = None,
) -> AdminPost
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ—Å—Ç —Å `is_template=False`
- –ö–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª—é–±—ã–µ –ø–æ–ª—è
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ö–µ—à—Ç–µ–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### –ü–æ–∏—Å–∫ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### `search_templates()`
–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —à–∞–±–ª–æ–Ω–∞–º.

```python
async def search_templates(
    user_id: int,
    query: str,
    limit: int = 20,
    include_content: bool = True,
) -> List[AdminPost]
```

**–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ:**
- –ù–∞–∑–≤–∞–Ω–∏—é —à–∞–±–ª–æ–Ω–∞
- –û–ø–∏—Å–∞–Ω–∏—é
- –ó–∞–≥–æ–ª–æ–≤–∫—É
- –°–æ–¥–µ—Ä–∂–∏–º–æ–º—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –•–µ—à—Ç–µ–≥–∞–º
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è–º

#### `get_recommended_templates()`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

```python
async def get_recommended_templates(
    user_id: int,
    based_on_categories: List[str],
    limit: int = 5
) -> List[AdminPost]
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### `get_template_categories()`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```python
async def get_template_categories(
    user_id: int
) -> List[str]
```

#### `get_template_statistics()`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —à–∞–±–ª–æ–Ω–∞–º.

```python
async def get_template_statistics(
    user_id: int
) -> Dict[str, Any]
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    "total_templates": int,
    "categories_count": int,
    "category_distribution": Dict[str, int],
    "media_type_distribution": Dict[str, int],
    "most_recent": str  # ISO datetime
}
```

### –≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç

#### `export_template()`
–≠–∫—Å–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞ –≤ JSON —Ñ–æ—Ä–º–∞—Ç.

```python
async def export_template(
    template_id: int,
    user_id: int
) -> Dict[str, Any]
```

**–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:**
```json
{
    "template_name": "string",
    "template_description": "string",
    "title": "string",
    "content": "string",
    "media_type": "string",
    "media_caption": "string",
    "hashtags": ["string"],
    "links": [{"url": "string", "text": "string"}],
    "categories": ["string"],
    "exported_at": "ISO datetime",
    "version": "1.0"
}
```

#### `import_template()`
–ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞ –∏–∑ JSON —Ñ–æ—Ä–º–∞—Ç–∞.

```python
async def import_template(
    template_data: Dict[str, Any],
    user_id: int
) -> AdminPost
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

```python
async def create_simple_template():
    async with get_session() as session:
        uow = UnitOfWork(session)
        
        template = await uow.template_service.create_template(
            title="–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞",
            content="üì∞ –ù–æ–≤–æ—Å—Ç–∏ –∑–∞ {date}\n\n{content}\n\n#–Ω–æ–≤–æ—Å—Ç–∏",
            template_name="daily_news",
            template_description="–®–∞–±–ª–æ–Ω –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π",
            created_by=123456789,
            categories=["–ù–æ–≤–æ—Å—Ç–∏"]
        )
        
        await session.commit()
        return template
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞

```python
async def use_template():
    async with get_session() as session:
        uow = UnitOfWork(session)
        
        # –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω
        template = await uow.template_service.get_template_by_name(
            "daily_news", 123456789
        )
        
        # –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç —Å –∑–∞–º–µ–Ω–æ–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
        content = template.content.replace(
            "{date}", "15 –¥–µ–∫–∞–±—Ä—è 2024"
        ).replace(
            "{content}", "–í–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–Ω—è..."
        )
        
        post = await uow.template_service.create_post_from_template(
            template_id=template.id,
            user_id=123456789,
            content=content,
            target_groups=[1001, 1002],
            scheduled_at=datetime.now() + timedelta(hours=1)
        )
        
        await session.commit()
        return post
```

### –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

```python
async def search_templates():
    async with get_session() as session:
        uow = UnitOfWork(session)
        
        # –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É
        results = await uow.template_service.search_templates(
            user_id=123456789,
            query="–Ω–æ–≤–æ—Å—Ç–∏",
            limit=10
        )
        
        # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        news_templates = await uow.template_service.get_user_templates(
            user_id=123456789,
            category="–ù–æ–≤–æ—Å—Ç–∏",
            sort_by="updated_at",
            sort_order="desc"
        )
        
        return results, news_templates
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

```python
# –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
@dp.message_handler(commands=['create_template'])
async def create_template_command(message: types.Message):
    # –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞
    pass

# –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
@dp.message_handler(commands=['templates'])
async def list_templates_command(message: types.Message):
    async with get_session() as session:
        uow = UnitOfWork(session)
        
        templates = await uow.template_service.get_user_templates(
            user_id=message.from_user.id,
            limit=10
        )
        
        if not templates:
            await message.reply("üìù –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤")
            return
        
        response = "üìã –í–∞—à–∏ —à–∞–±–ª–æ–Ω—ã:\n\n"
        for template in templates:
            response += f"‚Ä¢ {template.template_name}\n"
            response += f"  {template.title}\n\n"
        
        await message.reply(response)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
@dp.message_handler(commands=['use_template'])
async def use_template_command(message: types.Message):
    # –õ–æ–≥–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞
    pass
```

### Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

```python
def get_templates_keyboard(templates: List[AdminPost]) -> InlineKeyboardMarkup:
    keyboard = InlineKeyboardMarkup()
    
    for template in templates:
        keyboard.add(
            InlineKeyboardButton(
                text=template.template_name,
                callback_data=f"use_template:{template.id}"
            )
        )
    
    return keyboard

@dp.callback_query_handler(lambda c: c.data.startswith('use_template:'))
async def use_template_callback(callback_query: types.CallbackQuery):
    template_id = int(callback_query.data.split(':')[1])
    
    async with get_session() as session:
        uow = UnitOfWork(session)
        
        post = await uow.template_service.create_post_from_template(
            template_id=template_id,
            user_id=callback_query.from_user.id,
            target_groups=[1001]  # –ì—Ä—É–ø–ø—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        )
        
        await session.commit()
        await callback_query.answer("‚úÖ –ü–æ—Å—Ç —Å–æ–∑–¥–∞–Ω –∏–∑ —à–∞–±–ª–æ–Ω–∞!")
```

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª—å —à–∞–±–ª–æ–Ω–∞

```python
class AdminPost(Base):
    # –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
    id: int
    title: str
    content: str
    
    # –ü–æ–ª—è —à–∞–±–ª–æ–Ω–∞
    is_template: bool = False
    template_name: Optional[str] = None
    template_description: Optional[str] = None
    
    # –ú–µ–¥–∏–∞
    media_type: Optional[MediaType] = None
    media_file_id: Optional[str] = None
    media_caption: Optional[str] = None
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    hashtags: List[str] = []
    links: List[Dict[str, str]] = []
    categories: List[str] = []
    
    # –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è
    created_by: int
    created_at: datetime
    updated_at: datetime
```

### –§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞

```python
{
    "template_name": "daily_news",
    "template_description": "–®–∞–±–ª–æ–Ω –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π",
    "title": "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞",
    "content": "üì∞ –ù–æ–≤–æ—Å—Ç–∏ –∑–∞ {date}\n\n{content}\n\n#–Ω–æ–≤–æ—Å—Ç–∏",
    "media_type": null,
    "media_caption": null,
    "hashtags": ["–Ω–æ–≤–æ—Å—Ç–∏", "—Å–≤–æ–¥–∫–∞"],
    "links": [],
    "categories": ["–ù–æ–≤–æ—Å—Ç–∏"],
    "exported_at": "2024-12-15T10:30:00Z",
    "version": "1.0"
}
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```python
# –õ–∏–º–∏—Ç—ã
MAX_TEMPLATES_PER_USER = 100
MAX_TEMPLATE_NAME_LENGTH = 255
MAX_TEMPLATE_DESCRIPTION_LENGTH = 1000

# –ü–æ–∏—Å–∫
DEFAULT_SEARCH_LIMIT = 20
MAX_SEARCH_LIMIT = 100

# –≠–∫—Å–ø–æ—Ä—Ç
EXPORT_VERSION = "1.0"
SUPPORTED_IMPORT_VERSIONS = ["1.0"]
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
TEMPLATE_CACHE_TTL=3600  # –í—Ä–µ–º—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
TEMPLATE_SEARCH_TIMEOUT=30  # –¢–∞–π–º–∞—É—Ç –ø–æ–∏—Å–∫–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```sql
CREATE INDEX idx_admin_posts_template ON admin_posts(is_template, created_by);
CREATE INDEX idx_admin_posts_template_name ON admin_posts(template_name, created_by);
CREATE INDEX idx_admin_posts_categories ON admin_posts USING GIN(categories);
```

2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

3. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LIMIT/OFFSET –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- –ö—É—Ä—Å–æ—Ä–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```python
# –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- template_creation_count
- template_usage_count
- search_query_duration
- export_import_operations
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞

1. **–í–ª–∞–¥–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–º:**
```python
# –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç created_by
template = await self._get_template_by_id(template_id, user_id)
if not template:
    raise ValueError("–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω
# –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –ø–æ–ª–µ–π
# –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```

3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
```python
# –õ–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –º–µ–¥–∏–∞ —Ñ–∞–π–ª—ã
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–±—ã—Ç–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –°–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ
logger.info(f"–°–æ–∑–¥–∞–Ω —à–∞–±–ª–æ–Ω '{template_name}' –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
logger.info(f"–û–±–Ω–æ–≤–ª–µ–Ω —à–∞–±–ª–æ–Ω {template_id}")
logger.info(f"–£–¥–∞–ª–µ–Ω —à–∞–±–ª–æ–Ω {template_id}")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
logger.info(f"–°–æ–∑–¥–∞–Ω –ø–æ—Å—Ç –∏–∑ —à–∞–±–ª–æ–Ω–∞ '{template_name}'")
logger.info(f"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —à–∞–±–ª–æ–Ω {template_id}")
logger.info(f"–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —à–∞–±–ª–æ–Ω '{template_name}'")

# –û—à–∏–±–∫–∏
logger.error(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞: {error}")
logger.warning(f"–ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–æ–º—É —à–∞–±–ª–æ–Ω—É: user={user_id}, template={template_id}")
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤:**
```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
# –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
```

2. **–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ü—É–±–ª–∏—á–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
# –®–∞–±–ª–æ–Ω—ã –∫–æ–º–∞–Ω–¥—ã
# –ò–º–ø–æ—Ä—Ç –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```

3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:**
```python
# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
# –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```

4. **AI-–ø–æ–º–æ—â–Ω–∏–∫:**
```python
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤
# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
```

5. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
# –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —à–∞–±–ª–æ–Ω–æ–≤
# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–æ–≤
# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —à–∞–±–ª–æ–Ω–∞

```python
# Alembic migration
def upgrade():
    op.add_column('admin_posts', sa.Column('is_template', sa.Boolean(), nullable=False, default=False))
    op.add_column('admin_posts', sa.Column('template_name', sa.String(255), nullable=True))
    op.add_column('admin_posts', sa.Column('template_description', sa.Text(), nullable=True))
    
    # –ò–Ω–¥–µ–∫—Å—ã
    op.create_index('idx_admin_posts_template', 'admin_posts', ['is_template', 'created_by'])
    op.create_index('idx_admin_posts_template_name', 'admin_posts', ['template_name', 'created_by'])

def downgrade():
    op.drop_index('idx_admin_posts_template_name')
    op.drop_index('idx_admin_posts_template')
    op.drop_column('admin_posts', 'template_description')
    op.drop_column('admin_posts', 'template_name')
    op.drop_column('admin_posts', 'is_template')
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

`TemplateService` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –∏ –≥–∏–±–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏ –ø–æ—Å—Ç–æ–≤. –û–Ω –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –≤ Telegram –±–æ—Ç–µ.

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤
- **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö